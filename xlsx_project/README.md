# Excel to JSON Converter for PMSEch

این ابزار برای تبدیل فایل‌های اکسل تولید به فرمت JSON برای استفاده در اپلیکیشن PMSEch طراحی شده است.

## ساختار فایل اکسل

فایل اکسل باید شامل 23 ستون باشد که از راست به چپ به ترتیب زیر قرار دارند:

1. **تاریخ شمسی** - فرمت: `[$-fa-IR,96]yyyy\/mm\/dd;@`
2. **سال** - عدد (مثل 1402)
3. **ماه** - عدد (1-12)
4. **روز** - عدد (1-31)
5. **شیفت** - عدد (1، 2، 3)
6. **شرح توقف** - متن
7. **نام تجهیزات** - متن
8. **کد تجهیز 1** - متن (غیرقابل استفاده)
9. **کد تجهیز 2** - متن (غیرقابل استفاده)
10. **ریز تجهیزات** - متن
11. **کد ریز تجهیز** - متن (غیرقابل استفاده)
12. **علت توقف** - متن
13. **نوع توقف** - متن (معدنی، بهره‌برداری، مکانیکی، برقی، تاسیساتی، برنامه‌ای، بارگیری، عمومی، مجاز)
14. **شروع توقف** - زمان (HH:MM)
15. **پایان توقف** - زمان (HH:MM)
16. **مدت توقف** - زمان (HH:MM)
17. **تعداد سرویس** - عدد
18. **تناژ ورودی** - عدد (تن)
19. **اسکیل 3** - عدد (تن)
20. **اسکیل 4** - عدد (تن)
21. **اسکیل 5** - عدد (تن)
22. **گروه** - عدد (1-4)
23. **فید مستقیم** - عدد (0 یا 1)

## نصب

1. Composer را نصب کنید (اگر نصب نیست)
2. در پوشه پروژه دستور زیر را اجرا کنید:

```bash
composer install
```

## استفاده

### روش 1: آپلود فایل

```bash
curl -X POST -F "excel_file=@your_file.xlsx" http://your-domain.com/xlsx_to_json.php
```

### روش 2: استفاده از فایل موجود

```bash
curl "http://your-domain.com/xlsx_to_json.php?file=production_data.xlsx"
```

## پاسخ JSON

پاسخ شامل موارد زیر است:

```json
{
    "success": true,
    "data": [
        {
            "shamsi_date": "1402/01/15",
            "year": 1402,
            "month": 1,
            "day": 15,
            "shift": 1,
            "stop_description": "تعمیرات دوره‌ای",
            "equipment_name": "سنگ شکن فکی",
            "equipment_code_1": "",
            "equipment_code_2": "",
            "sub_equipment": "موتور اصلی",
            "sub_equipment_code": "",
            "stop_reason": "تعمیرات",
            "stop_type": "مکانیکی",
            "stop_start_time": "08:00",
            "stop_end_time": "10:30",
            "stop_duration": "02:30",
            "service_count": 15,
            "input_tonnage": 450.5,
            "scale_3": 0.0,
            "scale_4": 0.0,
            "scale_5": 0.0,
            "group": 1,
            "direct_feed": 1
        }
    ],
    "total_records": 1,
    "message": "داده‌ها با موفقیت تبدیل شدند"
}
```

## خطاها

در صورت بروز خطا، پاسخ شامل موارد زیر خواهد بود:

```json
{
    "success": false,
    "error": "توضیح خطا",
    "data": []
}
```

## نکات مهم

1. **فید مستقیم**: اگر مقدار 1 باشد، محصول تولید شده برابر تناژ ورودی است
2. **پرعیارسازی**: اگر مقدار 0 باشد، محصول تولید شده برابر مجموع اسکیل 3، 4، 5 است
3. **توقفات اضطراری**: مجموع توقفات مکانیکی، برقی و تاسیساتی
4. **توقفات فنی**: مجموع توقفات اضطراری و برنامه‌ای

## تنظیمات سرور

اطمینان حاصل کنید که:

1. PHP نسخه 7.4 یا بالاتر نصب باشد
2. Extension های `zip` و `xml` فعال باشند
3. حافظه کافی برای پردازش فایل‌های بزرگ در نظر گرفته شود
4. محدودیت آپلود فایل در `php.ini` تنظیم شود

## مثال کامل

```bash
# آپلود فایل
curl -X POST \
  -F "excel_file=@production_data.xlsx" \
  http://localhost/xlsx_project/xlsx_to_json.php

# دریافت فایل موجود
curl "http://localhost/xlsx_project/xlsx_to_json.php?file=production_data.xlsx"
``` 
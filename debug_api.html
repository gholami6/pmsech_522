<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>دیباگ API</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <style>
        body { background-color: #CFD8DC; }
        .card { background-color: #FFFFFF; }
        pre { white-space: pre-wrap; word-wrap: break-word; direction: ltr; text-align: left; }
    </style>
  </head>
  <body>
    <div class="container py-4">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <h1 class="h4 m-0">دیباگ API</h1>
        <button class="btn btn-primary" onclick="testAPI()">تست API</button>
      </div>
      <div class="card shadow-sm">
        <div class="card-body" id="result">
          <div class="text-muted">برای شروع روی «تست API» کلیک کنید.</div>
        </div>
      </div>
    </div>

    <script>
      async function testAPI() {
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = '<div class="text-secondary">در حال تست...</div>';

        try {
          const response = await fetch('https://sechahoon.liara.run/simple_xlsx_to_json.php?debug=columns');
          const text = await response.text();

          let html = '<h2 class="h6">پاسخ خام API:</h2>';
          html += '<pre class="bg-light p-3 rounded border">' + text.replace(/</g,'&lt;') + '</pre>';

          try {
            const data = JSON.parse(text);
            html += '<h2 class="h6 mt-3">پاسخ JSON:</h2>';
            html += '<pre class="bg-light p-3 rounded border">' +
                    JSON.stringify(data, null, 2) + '</pre>';
          } catch (parseError) {
            html += '<p class="text-danger mt-2">خطا در تجزیه JSON: ' + parseError.message + '</p>';
          }

          resultDiv.innerHTML = html;
        } catch (error) {
          resultDiv.innerHTML = '<p class="text-danger">خطا: ' + error.message + '</p>';
        }
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
  </html>
# راهنمای بهینه‌سازی سرعت دانلود

## مشکل فعلی
سرعت دانلود داده‌ها بسیار کند است و این مسئله کارایی برنامه را کاهش داده است.

## راه‌حل‌های اعمال شده

### 1. بهینه‌سازی کد Flutter
- **افزایش timeout**: از 30 ثانیه به 120 ثانیه (2 دقیقه)
- **بهبود batch processing**: افزایش اندازه batch به 1000 رکورد
- **بهینه‌سازی حافظه**: بهبود مدیریت حافظه در پردازش داده‌ها

### 2. فایل PHP بهینه‌سازی شده
فایل `simple_xlsx_to_json_optimized.php` با ویژگی‌های زیر ایجاد شده:

#### ویژگی‌های بهینه‌سازی:
- **حافظه**: افزایش حد حافظه به 512MB
- **زمان اجرا**: افزایش حد زمان اجرا به 5 دقیقه
- **فشرده‌سازی**: فعال‌سازی فشرده‌سازی gzip
- **پردازش batch**: پردازش داده‌ها به صورت دسته‌ای
- **مدیریت حافظه**: آزادسازی حافظه در طول پردازش

## نحوه اعمال تغییرات

### مرحله 1: آپلود فایل PHP جدید
1. فایل `simple_xlsx_to_json_optimized.php` را به هاست آپلود کنید
2. اطمینان حاصل کنید که فایل `sample_data.csv` نیز موجود است

### مرحله 2: تست فایل جدید
آدرس تست:
```
https://sechahoon.liara.run/simple_xlsx_to_json_optimized.php
```

### مرحله 3: تغییر نام فایل (اختیاری)
برای استفاده از فایل جدید، دو روش دارید:

#### روش 1: جایگزینی فایل قدیمی
1. فایل قدیمی `simple_xlsx_to_json.php` را پشتیبان‌گیری کنید
2. نام فایل جدید را به `simple_xlsx_to_json.php` تغییر دهید

#### روش 2: تغییر endpoint در برنامه
در فایل `simple_data_sync_service.dart`:
```dart
// تغییر این خط:
static const String _apiEndpoint = '/simple_xlsx_to_json.php';
// به:
static const String _apiEndpoint = '/simple_xlsx_to_json_optimized.php';
```

## بهبودهای قابل انتظار

### سرعت:
- **کاهش زمان دانلود**: 50-70% بهبود سرعت
- **مدیریت بهتر حافظه**: جلوگیری از خطاهای حافظه
- **پردازش سریع‌تر**: پردازش batch بهجای تک‌تک

### قابلیت اطمینان:
- **timeout بیشتر**: فرصت بیشتر برای دانلود
- **مدیریت خطا**: مدیریت بهتر خطاها
- **مونیتورینگ**: نمایش اطلاعات performance

## نکات مهم

1. **پشتیبان‌گیری**: قبل از تغییرات، از فایل قدیمی پشتیبان‌گیری کنید
2. **تست**: پس از آپلود، حتماً فایل جدید را تست کنید
3. **مونیتورینگ**: لاگ‌های برنامه را برای بررسی بهبود سرعت بررسی کنید

## عیب‌یابی

### اگر فایل کار نکرد:
1. بررسی کنید فایل درست آپلود شده است
2. مجوزهای فایل را بررسی کنید (744 یا 755)
3. فایل `sample_data.csv` موجود باشد

### اگر هنوز کند است:
1. بررسی کنید آیا از فایل جدید استفاده می‌شود
2. اتصال اینترنت و سرعت شبکه را بررسی کنید
3. حجم فایل CSV را بررسی کنید

## آمار عملکرد

فایل جدید اطلاعات زیر را در پاسخ نمایش می‌دهد:
- زمان اجرا (میلی‌ثانیه)
- مصرف حافظه
- تعداد رکوردهای پردازش شده
- نسخه PHP

این اطلاعات برای تشخیص مشکل و بهینه‌سازی بیشتر مفید هستند. 
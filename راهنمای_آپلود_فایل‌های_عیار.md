# راهنمای آپلود فایل‌های عیار به هاست

## 📋 **فایل‌های مورد نیاز برای آپلود**

### **1. فایل PHP اصلی**
- **نام فایل**: `grade_api.php`
- **محل آپلود**: روت هاست (`https://sechahoon.liara.run/`)
- **توضیحات**: API اصلی برای مدیریت عیارها

### **2. فایل CSV داده‌ها**
- **نام فایل**: `real_grades.csv`
- **محل آپلود**: روت هاست (`https://sechahoon.liara.run/`)
- **توضیحات**: فایل حاوی داده‌های عیار

## 🔧 **مراحل آپلود**

### **مرحله 1: آپلود فایل PHP**
1. فایل `grade_api.php` را در روت هاست آپلود کنید
2. مطمئن شوید که فایل قابل اجرا است (permissions: 644)
3. تست کنید: `https://sechahoon.liara.run/grade_api.php?action=stats&api_key=pmsech_grade_api_2024`

### **مرحله 2: آپلود فایل CSV**
1. فایل `real_grades.csv` را در روت هاست آپلود کنید
2. مطمئن شوید که فایل قابل خواندن است (permissions: 644)

### **مرحله 3: تست API**
```bash
# تست دانلود
curl "https://sechahoon.liara.run/grade_api.php?action=download" \
  -H "Authorization: Bearer pmsech_grade_api_2024"

# تست آمار
curl "https://sechahoon.liara.run/grade_api.php?action=stats" \
  -H "Authorization: Bearer pmsech_grade_api_2024"

# تست آپلود
curl -X POST "https://sechahoon.liara.run/grade_api.php?action=upload" \
  -H "Authorization: Bearer pmsech_grade_api_2024" \
  -H "Content-Type: application/json" \
  -d '{
    "date": "1404/04/01",
    "shift": 1,
    "grade_type": "خوراک",
    "grade_value": 30.5,
    "user_id": "test_user"
  }'
```

## 🔐 **امنیت**

### **کلید API**
- **کلید فعلی**: `pmsech_grade_api_2024`
- **توصیه**: در محیط تولید، کلید را تغییر دهید
- **محل تغییر**: در فایل `grade_api.php` خط 15

### **فایل لاگ**
- **نام فایل**: `grade_api.log`
- **محل**: روت هاست
- **توضیحات**: ثبت تمام عملیات API

## 📊 **فرمت فایل CSV**

### **هدر فایل**
```csv
id,date,shift,grade_type,grade_value,user_id,created_at,updated_at
```

### **نمونه داده**
```csv
grade_123456,1404/04/01,1,خوراک,30.5,user_001,2024-01-15 10:30:00,2024-01-15 10:30:00
grade_123457,1404/04/01,1,محصول,37.2,user_001,2024-01-15 10:30:00,2024-01-15 10:30:00
grade_123458,1404/04/01,1,باطله,12.1,user_001,2024-01-15 10:30:00,2024-01-15 10:30:00
```

## 🔄 **API Endpoints**

### **GET /grade_api.php?action=download**
- **توضیحات**: دانلود تمام داده‌های عیار
- **پاسخ**: JSON با فیلدهای `success`, `data`, `count`, `last_updated`

### **GET /grade_api.php?action=stats**
- **توضیحات**: دریافت آمار عیارها
- **پاسخ**: JSON با فیلدهای `total_records`, `by_type`, `by_shift`, `last_update`

### **POST /grade_api.php?action=upload**
- **توضیحات**: آپلود عیار جدید
- **بدنه**: JSON با فیلدهای `date`, `shift`, `grade_type`, `grade_value`, `user_id`
- **پاسخ**: JSON با فیلدهای `success`, `message`, `id`

## ⚠️ **نکات مهم**

1. **احراز هویت**: تمام درخواست‌ها نیاز به کلید API دارند
2. **فرمت تاریخ**: تاریخ‌ها باید به فرمت `YYYY/MM/DD` باشند
3. **شیفت**: فقط مقادیر 1، 2، 3 مجاز هستند
4. **نوع عیار**: فقط `خوراک`، `محصول`، `باطله` مجاز هستند
5. **مقدار عیار**: بین 0 تا 100 درصد
6. **تکراری**: عیار برای تاریخ، شیفت و نوع یکسان تکراری محسوب می‌شود

## 🐛 **عیب‌یابی**

### **خطای 401**
- کلید API اشتباه است
- Header Authorization وجود ندارد

### **خطای 400**
- داده‌های ورودی نامعتبر هستند
- فیلدهای الزامی وجود ندارند

### **خطای 409**
- رکورد تکراری است

### **خطای 500**
- خطای سرور
- بررسی فایل لاگ

## 📞 **پشتیبانی**

در صورت بروز مشکل:
1. فایل `grade_api.log` را بررسی کنید
2. تست API را انجام دهید
3. مجوزهای فایل را بررسی کنید
4. با تیم توسعه تماس بگیرید 
# تغییرات طراحی PDF - بهبود کامل

## 🎯 مشکلات حل شده

### ❌ **مشکلات قبلی:**
1. **چیدمان ستون‌ها:** ستون‌ها از چپ به راست بودند (برعکس برنامه)
2. **نمودار ساده:** بدون گریدلاین‌های حرفه‌ای
3. **محتوای مخلوط:** نمودار و جدول در یک صفحه
4. **فرمت نامشخص:** محدوده A4 دقیق تنظیم نشده بود
5. **عدم لجند:** نمودار بدون توضیح رنگ‌ها

### ✅ **راه‌حل‌های اعمال شده:**

## 📊 **1. نمودار حرفه‌ای (نیمه بالای صفحه اول)**

### ویژگی‌های جدید:
- **گریدلاین‌های عمودی و افقی:** برای خوانایی بهتر
- **لجند در پایین:** توضیح رنگ‌های آبی و قرمز
- **محدوده دقیق محورها:** بر اساس داده‌های واقعی
- **ارتفاع مناسب:** 300 پیکسل برای نمایش بهتر

### کد بهبود یافته:
```dart
static pw.Widget _buildChart(List<ChartPoint> actualData,
    List<ChartPoint> plannedData, pw.Font persianFont, pw.Font persianBoldFont) {
  // محاسبه محدوده Y برای نمودار
  final allValues = [
    ...actualData.map((p) => p.y),
    ...plannedData.map((p) => p.y)
  ];
  final maxY = allValues.isNotEmpty ? allValues.reduce((a, b) => a > b ? a : b) : 10;
  
  // ایجاد نقاط Y برای gridlines
  final yStep = maxY > 0 ? (maxY / 5).ceil() : 2;
  final yAxis = <double>[];
  for (int i = 0; i <= (maxY / yStep).ceil(); i++) {
    yAxis.add((i * yStep).toDouble());
  }
  
  return pw.Container(
    height: 300,
    child: pw.Column(
      children: [
        // عنوان نمودار
        pw.Text('نمودار خوراک ورودی', ...),
        // نمودار با گریدلاین
        pw.Chart(
          grid: pw.CartesianGrid(
            xAxis: pw.FixedAxis(xAxis),
            yAxis: pw.FixedAxis(yAxis),
          ),
          datasets: [
            pw.LineDataSet(legend: 'خوراک محقق شده', color: PdfColors.blue),
            pw.LineDataSet(legend: 'خوراک برنامه‌ریزی شده', color: PdfColors.red),
          ],
        ),
        // لجند
        pw.Row(
          children: [
            _buildLegendItem(PdfColors.blue, persianFont),
            _buildLegendItem(PdfColors.red, persianFont),
          ],
        ),
      ],
    ),
  );
}
```

## 📋 **2. جدول خلاصه (نیمه پایین صفحه اول)**

### ویژگی‌های جدید:
- **جدول ساده و خوانا:** فقط اطلاعات کلیدی
- **دو ستون:** شاخص و مقدار
- **اطلاعات ضروری:** کل خوراک، درصد انحراف، حداکثر روزانه

### ساختار جدید:
```
| شاخص                    | مقدار    |
|------------------------|----------|
| کل خوراک محقق شده (تن)  | 1,234.5  |
| کل خوراک برنامه‌ریزی شده | 1,200.0  |
| درصد انحراف            | +2.9%    |
| حداکثر روزانه (تن)     | 45.2     |
```

## 📋 **3. جدول جزئیات (صفحه دوم)**

### ویژگی‌های جدید:
- **چیدمان صحیح:** از راست به چپ مطابق برنامه
- **ستون‌های مرتب:** انحراف، برنامه، واقعی، شیفت، تاریخ
- **رنگ‌بندی انحراف:** سبز برای مثبت، قرمز برای منفی

### چیدمان جدید:
```
| انحراف | برنامه | واقعی | شیفت | تاریخ/بازه |
|--------|--------|-------|------|------------|
| +2.9%  | 100.0  | 102.9 | 1    | 1404/04/01 |
| -1.5%  | 100.0  | 98.5  | 2    | 1404/04/02 |
```

## 📄 **4. فرمت A4 دقیق**

### تنظیمات جدید:
- **صفحه اول:** نمودار + خلاصه
- **صفحه دوم:** جزئیات کامل
- **هدر یکسان:** در هر دو صفحه
- **محدوده دقیق:** تنظیم شده برای A4

### کد بهبود یافته:
```dart
pdf.addPage(
  pw.MultiPage(
    pageFormat: PdfPageFormat.a4,
    theme: pw.ThemeData.withFont(base: persianFont),
    build: (context) => [
      // صفحه اول - نمودار و خلاصه
      _buildFirstPage(...),
      // صفحه دوم - جدول جزئیات
      _buildDetailsPage(...),
    ],
  ),
);
```

## 🎨 **5. لجند نمودار**

### ویژگی‌های جدید:
- **نمایش رنگ‌ها:** خط آبی و قرمز
- **توضیح کامل:** خوراک محقق شده و برنامه‌ریزی شده
- **موقعیت مناسب:** در پایین نمودار

### کد جدید:
```dart
static pw.Widget _buildLegendItem(PdfColor color, pw.Font font) {
  return pw.Row(
    mainAxisSize: pw.MainAxisSize.min,
    children: [
      pw.Container(
        width: 16,
        height: 3,
        color: color,
      ),
      pw.SizedBox(width: 8),
      pw.Text(
        color == PdfColors.blue ? 'خوراک محقق شده' : 'خوراک برنامه‌ریزی شده',
        style: pw.TextStyle(fontSize: 10, font: font),
        textDirection: pw.TextDirection.rtl,
      ),
    ],
  );
}
```

## 📊 **6. بهبودهای کلی**

### ✅ **مشکلات حل شده:**
1. **چیدمان ستون‌ها:** حالا از راست به چپ مطابق برنامه
2. **نمودار حرفه‌ای:** با گریدلاین‌های عمودی و افقی
3. **جداسازی محتوا:** نمودار و خلاصه در صفحه اول، جزئیات در صفحه دوم
4. **فرمت A4 دقیق:** تنظیم شده در محدوده کاغذ A4
5. **لجند نمودار:** نمایش رنگ‌ها و توضیحات

### ✅ **بهبودهای طراحی:**
- نمودار در نیمه بالای صفحه اول
- جدول خلاصه در نیمه پایین صفحه اول
- جدول جزئیات در صفحه دوم
- چیدمان صحیح ستون‌ها از راست به چپ
- گریدلاین‌های حرفه‌ای در نمودار

## 🚀 **نتیجه نهایی**

حالا فایل‌های PDF تولید شده:
- **دقیقاً شبیه فرمت جداول برنامه** هستند
- **نمودار حرفه‌ای** با گریدلاین‌های عمودی و افقی دارند
- **چیدمان صحیح ستون‌ها** از راست به چپ دارند
- **در محدوده A4** تنظیم شده‌اند
- **جداسازی مناسب محتوا** در صفحات مختلف دارند

این تغییرات به عنوان **قالب استاندارد** برای تمام گزارشات PDF برنامه قابل استفاده است. 
# راهنمای وارد کردن میانگین ماهیانه عیارها

## مسئله
برای ماه‌های قبل از دی ماه 1403 (از ابتدای سال 1402 تا پایان آذر 1403 = 21 ماه)، تنها میانگین ماهیانه عیارها موجود است. برای هر ماه، 3 مقدار داریم:
- میانگین عیار خوراک 
- میانگین عیار محصول
- میانگین عیار باطله

## راه حل
سیستم حالا قابلیت وارد کردن میانگین ماهیانه را دارد که این مقادیر را برای تمام روزهای آن ماه تکرار می‌کند.

## نحوه استفاده

### روش 1: از طریق رابط کاربری

1. به صفحه **"وارد کردن داده‌های عیار"** بروید
2. روی تب **"میانگین ماهیانه"** کلیک کنید
3. مقادیر زیر را وارد کنید:
   - **سال**: مثال 1402
   - **ماه**: مثال 6 (برای خرداد)
   - **عیار خوراک**: مثال 35.65
   - **عیار محصول**: مثال 42.30  
   - **عیار باطله**: مثال 12.10
4. روی **"وارد کردن میانگین ماهیانه"** کلیک کنید

### روش 2: از طریق کد (برای توسعه‌دهندگان)

```dart
import '../services/grade_import_service.dart';

// وارد کردن یک ماه
final result = await GradeImportService.importMonthlyAverageGrades(
  monthlyAverages: {
    'خوراک': 35.65,
    'محصول': 42.30,
    'باطله': 12.10,
  },
  year: 1402,
  month: 6, // خرداد
  overrideExisting: false,
);

// وارد کردن چندین ماه
final monthsData = [
  {
    'year': 1402,
    'month': 1,
    'averages': {'خوراک': 34.5, 'محصول': 41.2, 'باطله': 11.8}
  },
  {
    'year': 1402,
    'month': 2,
    'averages': {'خوراک': 35.1, 'محصول': 42.0, 'باطله': 12.2}
  },
  // ...
];

final batchResult = await GradeImportService.importMultipleMonthlyAverages(
  monthsData: monthsData,
  overrideExisting: false,
);
```

## منطق عملکرد

### تکرار داده‌ها
- برای هر روز از ماه، 3 شیفت (صبح، عصر، شب) ایجاد می‌شود
- هر شیفت دارای 3 نوع عیار (خوراک، محصول، باطله) است
- مثال: برای خرداد 1402 (31 روز) = 31 روز × 3 شیفت × 3 عیار = 279 رکورد

### تعداد روزهای ماه
سیستم تعداد روزهای هر ماه شمسی را به درستی محاسبه می‌کند:
- فروردین تا شهریور: 31 روز
- مهر تا بهمن: 30 روز  
- اسفند: 29 روز (سال عادی) یا 30 روز (سال کبیسه)

### مثال عملی
**ورودی:**
- سال: 1402
- ماه: 6 (خرداد)
- عیار خوراک: 35.65
- عیار محصول: 42.30
- عیار باطله: 12.10

**خروجی:**
- 279 رکورد ایجاد می‌شود (31 روز × 3 شیفت × 3 عیار)
- تمام رکوردها دارای همان مقادیر عیار هستند
- شناسه کاربر: "monthly_average_import"

## نکات مهم

### اعتبارسنجی
- سال باید بین 1380 تا 1450 باشد
- ماه باید بین 1 تا 12 باشد  
- عیارها باید بین 0 تا 100 باشند

### جلوگیری از تکرار
- سیستم به طور پیش‌فرض از بازنویسی رکوردهای موجود جلوگیری می‌کند
- برای بازنویسی، پارامتر `overrideExisting: true` را استفاده کنید

### عملکرد
- عملیات به صورت دسته‌ای انجام می‌شود برای سرعت بالا
- پیشرفت عملیات نمایش داده می‌شود

## استفاده برای 21 ماه گذشته

برای وارد کردن تمام 21 ماه (از فروردین 1402 تا آذر 1403):

```dart
final historicalMonths = [
  // سال 1402
  {'year': 1402, 'month': 1, 'averages': {'خوراک': ..., 'محصول': ..., 'باطله': ...}},
  {'year': 1402, 'month': 2, 'averages': {'خوراک': ..., 'محصول': ..., 'باطله': ...}},
  // ... ادامه تا ماه 12
  
  // سال 1403
  {'year': 1403, 'month': 1, 'averages': {'خوراک': ..., 'محصول': ..., 'باطله': ...}},
  // ... ادامه تا ماه 9 (آذر)
];

final result = await GradeImportService.importMultipleMonthlyAverages(
  monthsData: historicalMonths,
);
```

## نتیجه
با این قابلیت، می‌توانید:
- میانگین ماهیانه را برای ماه‌های گذشته وارد کنید
- داده‌های یکسان برای تمام روزها و شیفت‌های یک ماه داشته باشید
- از تکرار داده‌ها جلوگیری کنید
- عملکرد گزارش‌گیری را بهبود بخشید

## پشتیبانی
برای سؤالات بیشتر یا مشکلات احتمالی، با تیم توسعه تماس بگیرید. 
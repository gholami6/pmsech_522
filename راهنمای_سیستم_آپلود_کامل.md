# راهنمای کامل سیستم آپلود فایل

## خلاصه
سیستم کامل آپلود، مدیریت و دانلود فایل‌ها که امکان آپلود فایل از موبایل به سرور را فراهم می‌کند.

## فایل‌های ایجاد شده

### 1. فایل‌های سرور (PHP)
- **`document_upload_api.php`**: API اصلی برای آپلود، دانلود و مدیریت فایل‌ها
- **`sample_documents.php`**: ایجاد فایل‌های نمونه PDF

### 2. فایل‌های Flutter
- **`lib/services/document_upload_service.dart`**: سرویس ارتباط با API
- **`lib/screens/document_upload_screen.dart`**: صفحه آپلود فایل
- **`lib/screens/document_management_screen.dart`**: صفحه مدیریت فایل‌ها

## مراحل راه‌اندازی

### مرحله 1: آپلود فایل‌های PHP به سرور
1. فایل `document_upload_api.php` را در ریشه هاست آپلود کنید
2. فایل `sample_documents.php` را در ریشه هاست آپلود کنید
3. مطمئن شوید که پوشه `uploads/documents/` قابل نوشتن است

### مرحله 2: تنظیم مجوزها
```bash
# در هاست، مجوزهای لازم را تنظیم کنید
chmod 755 uploads/
chmod 755 uploads/documents/
chmod 644 document_upload_api.php
chmod 644 sample_documents.php
```

### مرحله 3: ایجاد فایل‌های نمونه
1. در مرورگر، آدرس زیر را باز کنید:
   ```
   https://sechahoon.liara.run/sample_documents.php
   ```
2. این کار فایل‌های PDF نمونه را در سرور ایجاد می‌کند

### مرحله 4: تست API
برای تست API، آدرس زیر را در مرورگر باز کنید:
```
https://sechahoon.liara.run/document_upload_api.php?action=info
```

## قابلیت‌های سیستم

### آپلود فایل
- **انواع مجاز**: PDF, DOC, DOCX, XLS, XLSX, TXT, JPG, JPEG, PNG, GIF
- **حداکثر حجم**: 50 مگابایت
- **دسته‌بندی**: عمومی، تولید، توقفات، کیفیت، تعمیرات، آموزش، سایر
- **عمومی/خصوصی**: امکان تنظیم دسترسی فایل‌ها

### مدیریت فایل‌ها
- **جستجو**: بر اساس نام و توضیحات
- **فیلتر**: بر اساس دسته‌بندی و عمومی/خصوصی
- **دانلود**: ذخیره در پوشه Downloads دستگاه
- **حذف**: فقط برای مالک فایل یا مدیران

### امنیت
- **احراز هویت**: بر اساس کاربر وارد شده
- **دسترسی**: کنترل دسترسی بر اساس نقش کاربر
- **اعتبارسنجی**: بررسی نوع و حجم فایل

## نحوه استفاده در اپلیکیشن

### 1. آپلود فایل
1. در منوی اصلی، روی آیکن "آپلود فایل" کلیک کنید
2. فایل مورد نظر را انتخاب کنید
3. اطلاعات فایل را وارد کنید (توضیحات، دسته‌بندی، عمومی/خصوصی)
4. روی "آپلود فایل" کلیک کنید

### 2. مشاهده و دانلود فایل‌ها
1. در منوی اصلی، روی "مدارک و مستندات" کلیک کنید
2. فایل‌ها را جستجو و فیلتر کنید
3. روی فایل مورد نظر کلیک کنید تا دانلود شود

### 3. مدیریت فایل‌ها
1. در منوی اصلی، روی "مدیریت مدارک" کلیک کنید
2. فایل‌های خود را مشاهده و مدیریت کنید
3. فایل‌های غیرضروری را حذف کنید

## API Endpoints

### آپلود فایل
```
POST /document_upload_api.php?action=upload
Content-Type: multipart/form-data

Fields:
- document: فایل
- user_id: شناسه کاربر
- user_name: نام کاربر
- description: توضیحات
- category: دسته‌بندی
- is_public: عمومی (true/false)
```

### لیست فایل‌ها
```
GET /document_upload_api.php?action=list
Parameters:
- category: دسته‌بندی (اختیاری)
- user_id: شناسه کاربر (اختیاری)
- public: فقط عمومی (true/false) (اختیاری)
```

### دانلود فایل
```
GET /document_upload_api.php?action=download&id=DOCUMENT_ID
```

### حذف فایل
```
POST /document_upload_api.php?action=delete
Body:
- id: شناسه فایل
- user_id: شناسه کاربر
```

### اطلاعات کلی
```
GET /document_upload_api.php?action=info
```

## ساختار دیتابیس
فایل‌ها در `documents_database.json` ذخیره می‌شوند:
```json
[
  {
    "id": "unique_id",
    "name": "نام فایل",
    "file_name": "unique_filename.pdf",
    "extension": "pdf",
    "size": 1024000,
    "formatted_size": "1.0 MB",
    "user_id": "user_id",
    "user_name": "نام کاربر",
    "description": "توضیحات فایل",
    "category": "عمومی",
    "is_public": true,
    "upload_date": "2024-01-01 12:00:00",
    "download_count": 0,
    "file_path": "./uploads/documents/unique_filename.pdf"
  }
]
```

## عیب‌یابی

### مشکل: فایل آپلود نمی‌شود
- مجوزهای پوشه `uploads/documents/` را بررسی کنید
- حجم فایل را بررسی کنید (حداکثر 50MB)
- نوع فایل را بررسی کنید

### مشکل: دانلود کار نمی‌کند
- اتصال اینترنت را بررسی کنید
- آدرس سرور را بررسی کنید
- فایل در سرور موجود است یا نه

### مشکل: فایل‌ها نمایش داده نمی‌شوند
- فایل `documents_database.json` را بررسی کنید
- API را تست کنید
- لاگ‌های سرور را بررسی کنید

## نکات مهم
1. فایل‌ها با نام‌های منحصر به فرد ذخیره می‌شوند
2. فقط مالک فایل یا مدیران می‌توانند فایل را حذف کنند
3. فایل‌های خصوصی فقط برای کاربران مجاز قابل مشاهده هستند
4. سیستم به صورت خودکار تعداد دانلودها را ثبت می‌کند
5. فایل‌ها در پوشه Downloads دستگاه ذخیره می‌شوند

## پشتیبانی
در صورت بروز مشکل، لاگ‌های سرور و اپلیکیشن را بررسی کنید و با تیم پشتیبانی تماس بگیرید. 
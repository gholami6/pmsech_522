# راهنمای سیستم آپلود مدارک

## مقدمه
این سیستم امکان آپلود، مدیریت و اشتراک‌گذاری مدارک را بین کاربران فراهم می‌کند.

## فایل‌های ایجاد شده

### 1. فایل PHP (document_upload_api.php)
- **محل**: در ریشه پروژه
- **وظیفه**: API برای آپلود، دانلود و مدیریت فایل‌ها
- **قابلیت‌ها**:
  - آپلود فایل (حداکثر 50MB)
  - لیست فایل‌ها با فیلتر
  - دانلود فایل
  - حذف فایل
  - آمار کلی

### 2. سرویس Flutter (document_upload_service.dart)
- **محل**: `lib/services/document_upload_service.dart`
- **وظیفه**: ارتباط با API و مدیریت فایل‌ها در اپلیکیشن

### 3. صفحه مدیریت (document_management_screen.dart)
- **محل**: `lib/screens/document_management_screen.dart`
- **وظیفه**: رابط کاربری برای مدیریت فایل‌ها

## مراحل راه‌اندازی

### مرحله 1: آپلود فایل PHP به هاست
1. فایل `document_upload_api.php` را به هاست آپلود کنید
2. مطمئن شوید که پوشه `uploads/documents/` قابل نوشتن است
3. آدرس API را در فایل `document_upload_service.dart` تغییر دهید:

```dart
static const String baseUrl = 'https://your-domain.com'; // آدرس واقعی هاست
```

### مرحله 2: تنظیم مجوزها
```bash
# در هاست، مجوزهای لازم را تنظیم کنید
chmod 755 uploads/
chmod 755 uploads/documents/
chmod 644 document_upload_api.php
```

### مرحله 3: نصب وابستگی‌ها
```bash
flutter pub get
```

### مرحله 4: اضافه کردن صفحه به منو
در فایل `main_dashboard_page.dart` یا منوی اصلی، صفحه مدیریت مدارک را اضافه کنید:

```dart
// در لیست صفحات
const DocumentManagementScreen(),
```

## قابلیت‌های سیستم

### آپلود فایل
- **انواع مجاز**: PDF, DOC, DOCX, XLS, XLSX, TXT, JPG, JPEG, PNG, GIF
- **حداکثر حجم**: 50 مگابایت
- **حداکثر فایل per user**: 10 فایل
- **دسته‌بندی**: عمومی، تولید، توقفات، کیفیت، تعمیرات، آموزش، سایر

### مدیریت فایل‌ها
- **جستجو**: بر اساس نام و توضیحات
- **فیلتر**: بر اساس دسته‌بندی و عمومی/خصوصی
- **دانلود**: ذخیره در پوشه Downloads
- **حذف**: فقط برای مالک فایل یا مدیران

### امنیت
- **احراز هویت**: بر اساس کاربر وارد شده
- **دسترسی**: کنترل دسترسی بر اساس نقش کاربر
- **اعتبارسنجی**: بررسی نوع و حجم فایل

## API Endpoints

### آپلود فایل
```
POST /document_upload_api.php?action=upload
Content-Type: multipart/form-data

Fields:
- document: فایل
- user_id: شناسه کاربر
- user_name: نام کاربر
- description: توضیحات
- category: دسته‌بندی
- is_public: عمومی (true/false)
```

### لیست فایل‌ها
```
GET /document_upload_api.php?action=list
Parameters:
- category: دسته‌بندی (اختیاری)
- user_id: شناسه کاربر (اختیاری)
- public: فقط عمومی (true/false) (اختیاری)
```

### دانلود فایل
```
GET /document_upload_api.php?action=download&id=DOCUMENT_ID
```

### حذف فایل
```
POST /document_upload_api.php?action=delete
Body:
- id: شناسه فایل
- user_id: شناسه کاربر
```

### اطلاعات کلی
```
GET /document_upload_api.php?action=info
```

## ساختار دیتابیس
فایل `document_database.json` به صورت خودکار ایجاد می‌شود:

```json
[
  {
    "id": "unique_id",
    "original_name": "نام اصلی فایل",
    "file_name": "نام ذخیره شده",
    "file_path": "مسیر فایل",
    "file_size": 12345,
    "file_extension": "pdf",
    "user_id": "user_123",
    "user_name": "نام کاربر",
    "description": "توضیحات",
    "category": "عمومی",
    "upload_date": "2024-01-01 12:00:00",
    "download_count": 5,
    "is_public": true
  }
]
```

## عیب‌یابی

### خطاهای رایج
1. **خطا در آپلود**: بررسی مجوزهای پوشه uploads
2. **خطا در اتصال**: بررسی آدرس API در سرویس
3. **خطا در دانلود**: بررسی وجود فایل در سرور

### لاگ‌ها
فایل‌های لاگ در هاست بررسی کنید:
- error_log
- access_log

## نکات مهم
1. **پشتیبان‌گیری**: فایل‌های آپلود شده را به طور منظم پشتیبان‌گیری کنید
2. **نظارت**: حجم فایل‌ها را کنترل کنید
3. **امنیت**: مجوزهای فایل‌ها را محدود کنید
4. **بهینه‌سازی**: فایل‌های قدیمی را پاک کنید

## پشتیبانی
در صورت بروز مشکل، لاگ‌های سرور و اپلیکیشن را بررسی کنید. 